<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Data setting for drift scalars for coal combustion</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">programmer&#39;s documentation</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="cs_user_examples.html"><span>User&#160;examples</span></a></li>
      <li><a href="cs_var_dico.html"><span>Fortran-C&#160;naming&#160;reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="cs_user_examples.html">User examples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Data setting for drift scalars for coal combustion </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="drift_coal_scalars_intro"></a>
Introduction</h1>
<p>This page provides an example of code blocks that may be used to perform a calculation with drift scalars for coal combustion.</p>
<h1><a class="anchor" id="cs_user_physical_properties-coal_drift"></a>
Physical properties</h1>
<h2><a class="anchor" id="drift_coal_scalars_loc_var"></a>
Local variables to be added</h2>
<p>The following local variables need to be defined for the examples in this section:</p>
<div class="fragment"><div class="line"><span class="keywordtype">integer</span>          ivart, iel, ifac</div>
<div class="line"><span class="keywordtype">integer</span>          ivar</div>
<div class="line"><span class="keywordtype">integer</span>          f_id</div>
<div class="line"><span class="keywordtype">integer</span>          icla</div>
<div class="line"><span class="keywordtype">integer</span>          iscdri, keydri, iflid, nfld, keyccl</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double precision</span> xvart</div>
<div class="line"><span class="keywordtype">double precision</span> aa1, bb1, cc1, dd1</div>
<div class="line"><span class="keywordtype">double precision</span> aa2, bb2, cc2, dd2</div>
<div class="line"><span class="keywordtype">double precision</span> aa3, bb3, cc3, dd3</div>
<div class="line"><span class="keywordtype">double precision</span> aa4, bb4, cc4, dd4</div>
<div class="line"><span class="keywordtype">double precision</span> aa5, bb5, cc5, dd5</div>
<div class="line"><span class="keywordtype">double precision</span> aa6, bb6, cc6, dd6</div>
<div class="line"><span class="keywordtype">double precision</span> aa7, bb7, cc7, dd7</div>
<div class="line"><span class="keywordtype">double precision</span> visco_o2, visco_co, visco_h2, visco_n2</div>
<div class="line"><span class="keywordtype">double precision</span> visco_so2, visco_nh3, visco_co2</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">character*80</span>     fname</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: visco</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cpro_rom1, cpro_rom2, cpro_diam2</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cpro_temp1, cpro_x2, cpro_x1</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cpro_ym1_3, cpro_ym1_5, cpro_ym1_7</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cpro_ym1_8</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cpro_ym1_9, cpro_ym1_11, cpro_ym1_12</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cpro_taup</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cpro_taupg</div>
</div><!-- fragment --> <h2><a class="anchor" id="drift_coal_scalars_init"></a>
Initialization and finalization</h2>
<p>The following initialization block needs to be added for the following examples:</p>
<div class="fragment"><div class="line"><span class="keyword">allocate</span>(visco(<a class="code" href="group__mesh.html#ga639172a5bdf2c9669ddeab06a362b992">ncelet</a>))</div>
<div class="line"></div>
<div class="line">call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga95b11da3a4d116b11234ce59727e4c5c">iym1</a>(3)), cpro_ym1_3)</div>
<div class="line">call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga95b11da3a4d116b11234ce59727e4c5c">iym1</a>(5)), cpro_ym1_5)</div>
<div class="line">call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga95b11da3a4d116b11234ce59727e4c5c">iym1</a>(7)), cpro_ym1_7)</div>
<div class="line">call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga95b11da3a4d116b11234ce59727e4c5c">iym1</a>(8)), cpro_ym1_8)</div>
<div class="line">call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga95b11da3a4d116b11234ce59727e4c5c">iym1</a>(9)), cpro_ym1_9)</div>
<div class="line">call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga95b11da3a4d116b11234ce59727e4c5c">iym1</a>(11)), cpro_ym1_11)</div>
<div class="line">call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga95b11da3a4d116b11234ce59727e4c5c">iym1</a>(12)), cpro_ym1_12)</div>
<div class="line"></div>
<div class="line"><span class="comment">! Key id for drift scalar</span></div>
<div class="line">call <a class="code" href="classfield.html#ae0f3a6278a2fd7a0d76d0dae08fbbac8">field_get_key_id</a>(<span class="stringliteral">&quot;drift_scalar_model&quot;</span>, keydri)</div>
<div class="line"></div>
<div class="line"><span class="comment">! Key id of the coal scalar class</span></div>
<div class="line">call <a class="code" href="classfield.html#ae0f3a6278a2fd7a0d76d0dae08fbbac8">field_get_key_id</a>(<span class="stringliteral">&quot;scalar_class&quot;</span>, keyccl)</div>
<div class="line"></div>
<div class="line"><span class="comment">! Number of fields</span></div>
<div class="line">call <a class="code" href="classfield.html#a2a4a50d9ed1bb84285bd544fba2c56b5">field_get_n_fields</a>(nfld)</div>
</div><!-- fragment --><p> In theory Fortran 95 deallocates locally-allocated arrays automatically, but deallocating arrays in a symmetric manner to their allocation is good practice, and it avoids using a different logic for C and Fortran.</p>
<h2><a class="anchor" id="drift_coal_scalars_body"></a>
Body</h2>
<p>Here is the corresponding code:</p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="comment">! Temperature</span></div>
<div class="line"><span class="comment">call field_get_val_s(iprpfl(itemp1), cpro_temp1)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">! Gas density</span></div>
<div class="line"><span class="comment">call field_get_val_s(iprpfl(irom1), cpro_rom1)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">! First initialization</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__time__step__options.html#ga8893d91edb2d95d49bfeadfe9a3b12db">ntcabs</a>.le.1) <span class="keywordflow">then</span></div>
<div class="line">  <span class="keywordflow">do</span> iel = 1, <a class="code" href="group__mesh.html#gab639b5ed89912ab852608e25d395a782">ncel</a></div>
<div class="line">    visco(iel) = <a class="code" href="group__cstphy.html#gab7fbc85b2a13abe8a8d6a4df343995b3">viscl0</a></div>
<div class="line">    cpro_rom1(iel) = <a class="code" href="group__cstphy.html#gacff405ec8c1736a0ea97f7bbec06a6dd">ro0</a></div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line">  <span class="keywordflow">do</span> icla = 1, nclacp</div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga83a22ad073fc7284dd4f847b6a6f4d7a">irom2</a>(icla)), cpro_rom2)</div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga805a5da9fee61cf93bdb100edeaf80c0">idiam2</a>(icla)), cpro_diam2)</div>
<div class="line">    <span class="keywordflow">do</span> iel = 1, <a class="code" href="group__mesh.html#gab639b5ed89912ab852608e25d395a782">ncel</a></div>
<div class="line">      cpro_rom2(iel)  = rho20(icla)</div>
<div class="line">      cpro_diam2(iel) = diam20(icla)</div>
<div class="line">    <span class="keywordflow">enddo</span></div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line"><span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line"><span class="comment">!----------------Gas viscosity function of temperature--------------------------</span></div>
<div class="line"><span class="comment">!</span></div>
<div class="line"><span class="comment">!--------------------------1-O2 2-CO 3-H2 4-N2 5-SO2 6-NH3 7-CO2----------------</span></div>
<div class="line"></div>
<div class="line">aa1 = 4.0495d-6</div>
<div class="line">bb1 = 6.22d-8</div>
<div class="line"><span class="comment">cc1 = -2.3032d-11</span></div>
<div class="line">dd1 = 4.4077d-15</div>
<div class="line"></div>
<div class="line">aa2 = 9.9987d-6</div>
<div class="line">bb2 = 5.1578d-8</div>
<div class="line"><span class="comment">cc2 = -1.8383d-11</span></div>
<div class="line">dd2 = 3.33307d-15</div>
<div class="line"></div>
<div class="line">aa3 = 2.894d-6</div>
<div class="line">bb3 = 2.22508d-8</div>
<div class="line"><span class="comment">cc3 = -8.041d-12</span></div>
<div class="line">dd3 = 1.4619d-15</div>
<div class="line"></div>
<div class="line">aa4 = 4.3093d-6</div>
<div class="line">bb4 = 5.0516d-8</div>
<div class="line"><span class="comment">cc4 = -1.7869d-11</span></div>
<div class="line">dd4 = 3.2136d-15</div>
<div class="line"></div>
<div class="line">aa5 = -1.9889d-6</div>
<div class="line">bb5 = 5.365d-8</div>
<div class="line"><span class="comment">cc5 = -1.4286d-11</span></div>
<div class="line">dd5 = 2.1639d-15</div>
<div class="line"></div>
<div class="line">aa6 = -1.293d-6</div>
<div class="line">bb6 = 4.1194d-8</div>
<div class="line"><span class="comment">cc6 = -1.772d-11</span></div>
<div class="line">dd6 = 1.8699d-15</div>
<div class="line"></div>
<div class="line">aa7 = 4.4822d-7</div>
<div class="line">bb7 = 5.4327d-8</div>
<div class="line"><span class="comment">cc7 = -1.7581d-11</span></div>
<div class="line">dd7 = 2.9979d-15</div>
<div class="line"></div>
<div class="line"><span class="comment">!-------------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment">!      law                    mu   = a + b T + c T**2 + d T**3</span></div>
<div class="line"><span class="comment">!      so      cpro_viscl(iel) = a +b*xvart+c*xvart**2 + d*xvart**3</span></div>
<div class="line"><span class="comment">!-------------------------------------------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__time__step__options.html#ga8893d91edb2d95d49bfeadfe9a3b12db">ntcabs</a>.gt.1) <span class="keywordflow">then</span></div>
<div class="line">  <span class="keywordflow">do</span> iel = 1, <a class="code" href="group__mesh.html#gab639b5ed89912ab852608e25d395a782">ncel</a></div>
<div class="line"></div>
<div class="line">    xvart = cpro_temp1(iel)</div>
<div class="line">    visco_o2  = aa1 + xvart*bb1 + cc1*xvart**2 + dd1*xvart**3</div>
<div class="line">    visco_co  = aa2 + xvart*bb2 + cc2*xvart**2 + dd2*xvart**3</div>
<div class="line">    visco_h2  = aa3 + xvart*bb3 + cc3*xvart**2 + dd3*xvart**3</div>
<div class="line">    visco_n2  = aa4 + xvart*bb4 + cc4*xvart**2 + dd4*xvart**3</div>
<div class="line">    visco_so2 = aa5 + xvart*bb5 + cc5*xvart**2 + dd5*xvart**3</div>
<div class="line">    visco_nh3 = aa6 + xvart*bb6 + cc6*xvart**2 + dd6*xvart**3</div>
<div class="line">    visco_co2 = aa7 + xvart*bb7 + cc7*xvart**2 + dd7*xvart**3</div>
<div class="line"></div>
<div class="line">    <span class="comment">! Viscosity of the mixing</span></div>
<div class="line">    visco(iel) = ( cpro_ym1_8(iel) * visco_o2                     &amp;</div>
<div class="line">                 + cpro_ym1_3(iel) * visco_co                     &amp;</div>
<div class="line">                 + cpro_ym1_5(iel) * visco_h2                     &amp;</div>
<div class="line">                 + cpro_ym1_12(iel)* visco_n2                     &amp;</div>
<div class="line">                 + cpro_ym1_11(iel)* visco_so2                    &amp;</div>
<div class="line">                 + cpro_ym1_7(iel) * visco_nh3                    &amp;</div>
<div class="line">                 + cpro_ym1_9(iel) * visco_co2 )/                 &amp;</div>
<div class="line">                 ( cpro_ym1_8(iel) + cpro_ym1_3(iel)              &amp;</div>
<div class="line">                 + cpro_ym1_5(iel) + cpro_ym1_12(iel)             &amp;</div>
<div class="line">                 + cpro_ym1_11(iel)+ cpro_ym1_7(iel)              &amp;</div>
<div class="line">                 + cpro_ym1_9(iel))</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line"><span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line"><span class="comment">! get x1 = 1 - sum cpro_x2</span></div>
<div class="line"><span class="comment">call field_get_val_s_by_name(&quot;x_c&quot;, cpro_x1)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">! All gas scalars have the same drift as if1m(1)</span></div>
<div class="line"><span class="comment">!-----------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="keywordflow">do</span> iflid = 0, nfld-1</div>
<div class="line"></div>
<div class="line">  <span class="comment">! Index of the scalar class (&lt;0 if the scalar belongs to the gas phase)</span></div>
<div class="line">  call <a class="code" href="classfield.html#a5f63f3fbe551d4076fa8123eff37363e">field_get_key_int</a>(iflid, keyccl, icla)</div>
<div class="line"></div>
<div class="line">  call <a class="code" href="classfield.html#a5f63f3fbe551d4076fa8123eff37363e">field_get_key_int</a>(iflid, keydri, iscdri)</div>
<div class="line"></div>
<div class="line">  <span class="comment">! We only handle here one scalar with a drift per gas class</span></div>
<div class="line">  <span class="keywordflow">if</span> (icla.le.-1.and.btest(iscdri, <a class="code" href="group__scalar__params.html#ga1eda58232aae9031bafd40e88d52ebba">drift_scalar_add_drift_flux</a>)) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">! Position of variables, coefficients</span></div>
<div class="line">    <span class="comment">! -----------------------------------</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">! Name of the drift scalar</span></div>
<div class="line">    call <a class="code" href="classfield.html#a3bcff4a039dc8e4899e55061766b12a6">field_get_name</a>(iflid, fname)</div>
<div class="line"></div>
<div class="line">    <span class="comment">! Index of the corresponding &quot;relaxation time&quot; (cpro_taupg) for the gas</span></div>
<div class="line">    <span class="comment">! WARNING: for the gas, this tau might be negative</span></div>
<div class="line">    call <a class="code" href="classfield.html#ae3213fc0704a9ce8aed555bd1fc2602b">field_get_id</a>(<span class="stringliteral">&#39;drift_tau_&#39;</span>//trim(fname), f_id)</div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(f_id, cpro_taupg)</div>
<div class="line"></div>
<div class="line">    <span class="comment">! Initialize to 0</span></div>
<div class="line">    <span class="keywordflow">do</span> iel = 1, <a class="code" href="group__mesh.html#gab639b5ed89912ab852608e25d395a782">ncel</a></div>
<div class="line">      cpro_taupg(iel) = 0.d0</div>
<div class="line">    <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line"><span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line"><span class="comment">! Loop over coal particle classes</span></div>
<div class="line"><span class="comment">! We only handle here coal class with a drift</span></div>
<div class="line"><span class="comment">!--------------------------------------------</span></div>
<div class="line"></div>
<div class="line"><span class="keywordflow">do</span> iflid = 0, nfld-1</div>
<div class="line"></div>
<div class="line">  <span class="comment">! Index of the scalar class (&lt;0 if the scalar belongs to the gas phase)</span></div>
<div class="line">  call <a class="code" href="classfield.html#a5f63f3fbe551d4076fa8123eff37363e">field_get_key_int</a>(iflid, keyccl, icla)</div>
<div class="line"></div>
<div class="line">  call <a class="code" href="classfield.html#a5f63f3fbe551d4076fa8123eff37363e">field_get_key_int</a>(iflid, keydri, iscdri)</div>
<div class="line"></div>
<div class="line">  <span class="comment">! We only handle here one scalar with a drift per particle class</span></div>
<div class="line">  <span class="keywordflow">if</span> (icla.ge.1.and.btest(iscdri, <a class="code" href="group__scalar__params.html#ga1eda58232aae9031bafd40e88d52ebba">drift_scalar_add_drift_flux</a>)) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga83a22ad073fc7284dd4f847b6a6f4d7a">irom2</a>(icla)), cpro_rom2)</div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#ga805a5da9fee61cf93bdb100edeaf80c0">idiam2</a>(icla)), cpro_diam2)</div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#gaf42a6fc4a9bb1a28a5b835afb9615c3d">iprpfl</a>(<a class="code" href="group__coal__combustion.html#gad28ca905ac2632c7b15d4da4351dfdee">ix2</a>(icla)), cpro_x2)</div>
<div class="line"></div>
<div class="line">    <span class="comment">! Position of variables, coefficients</span></div>
<div class="line">    <span class="comment">! -----------------------------------</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">! Name of the drift scalar</span></div>
<div class="line">    call <a class="code" href="classfield.html#a3bcff4a039dc8e4899e55061766b12a6">field_get_name</a>(iflid, fname)</div>
<div class="line"></div>
<div class="line">    <span class="comment">! Index of the corresponding relaxation time (cpro_taup)</span></div>
<div class="line">    call <a class="code" href="classfield.html#ae3213fc0704a9ce8aed555bd1fc2602b">field_get_id</a>(<span class="stringliteral">&#39;drift_tau_&#39;</span>//trim(fname), f_id)</div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(f_id, cpro_taup)</div>
<div class="line"></div>
<div class="line">    <span class="comment">! Computation of the relaxation time of the particles</span></div>
<div class="line">    <span class="comment">! the drift is therefore v_g = tau_p * g</span></div>
<div class="line">    <span class="comment">!----------------------------------------------------</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">do</span> iel = 1, <a class="code" href="group__mesh.html#gab639b5ed89912ab852608e25d395a782">ncel</a></div>
<div class="line"></div>
<div class="line">      <span class="comment">! Simple model for Low Reynolds Numbers</span></div>
<div class="line">      cpro_taup(iel) = cpro_x1(iel) * cpro_rom2(iel)                &amp;</div>
<div class="line">                     * cpro_diam2(iel)**2                           &amp;</div>
<div class="line">                     / (18.d0*visco(iel))</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">! Drift for the gas:</span></div>
<div class="line">    <span class="comment">! tau_pg = - Sum_i X2_i v_gi</span></div>
<div class="line">    <span class="keywordflow">do</span> iel = 1, <a class="code" href="group__mesh.html#gab639b5ed89912ab852608e25d395a782">ncel</a></div>
<div class="line"></div>
<div class="line">      cpro_taupg(iel) = cpro_taupg(iel)                                  &amp;</div>
<div class="line">                      - ( cpro_taup(iel) * cpro_x2(iel) )</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">endif</span> <span class="comment">! test icla</span></div>
<div class="line"></div>
<div class="line"><span class="keywordflow">enddo</span> <span class="comment">! loop on iflid</span></div>
<div class="line"></div>
</div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 6 2016 17:20:36 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
