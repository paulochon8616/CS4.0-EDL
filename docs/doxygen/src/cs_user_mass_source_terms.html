<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Examples of data settings for mass source terms (cs_user_mass_source_terms.f90)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">programmer&#39;s documentation</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="cs_user_examples.html"><span>User&#160;examples</span></a></li>
      <li><a href="cs_var_dico.html"><span>Fortran-C&#160;naming&#160;reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="cs_user_examples.html">User examples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Examples of data settings for mass source terms (<a class="el" href="cs__user__mass__source__terms_8f90.html" title="Mass source term user subroutine. ">cs_user_mass_source_terms.f90</a>) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The subroutine <a class="el" href="cs_user_mass_source_terms.html">Examples of data settings for mass source terms (cs_user_mass_source_terms.f90)</a> is called at three different stages in the code <code> (iappel = 1, 2 or 3):</code></p><ul>
<li><code>iappel</code> = 1: Calculation of the number of cells where a mass source is imposed: <code>ncesmp</code>. Called once at the beginning of the calculation.</li>
<li><code>iappel</code> = 2: Identification of the cells where a mass source term is imposed: array <code>icesmp(ncesmp)</code>. Called once at the beginning of the calculation.</li>
<li><code>iappel</code> = 3: Calculation of the values of the mass source terms. Called at each time step.</li>
</ul>
<p>The equation for mass conservation becomes: <img class="formulaInl" alt="$ \der{\rho}{t}+\divs{(\rho \vect{u})}=\Gamma $" src="form_539.png"/></p>
<p>The equation for a variable <img class="formulaInl" alt="$ \varia $" src="form_0.png"/> becomes: <img class="formulaInl" alt="$ \frac{\Delta(\rho\varia)}{\Delta t} = ... + \Gamma(\varia^{in} - \varia) $" src="form_540.png"/> discretized as <img class="formulaInl" alt="$ \rho \dfrac{\varia^{(n+1)} - \varia^{(n)}}{\Delta t} = ... + \Gamma(\varia^{in} - \varia^{(n+1)}) $" src="form_541.png"/></p>
<p><img class="formulaInl" alt="$ \varia^{in} $" src="form_542.png"/> is the value of <img class="formulaInl" alt="$ \varia $" src="form_0.png"/> associated to the injected mass.</p>
<p>Two options are available:</p><ul>
<li>the mass flux is injected with the local value of variable <img class="formulaInl" alt="$ \varia $" src="form_0.png"/>: <img class="formulaInl" alt="$ \varia^{in} = \varia^{(n+1)} $" src="form_543.png"/> (the equation for <img class="formulaInl" alt="$ \varia $" src="form_0.png"/> is therefore not modified)</li>
<li>the mass flux is injected with a specific value for <img class="formulaInl" alt="$ \varia $" src="form_0.png"/>: <img class="formulaInl" alt="$ \varia^{in} $" src="form_542.png"/> is specified by the user</li>
</ul>
<h1><a class="anchor" id="var_user"></a>
Variables to be specified by the user</h1>
<ul>
<li><code>ncesmp:</code> number of cells where a mass source term is imposed</li>
<li><code>icetsm(ieltsm)</code>: identification of the cells where a mass source term is imposed. For each cell where a mass source term is imposed (<code>ielstm</code> in <code></code>[1;ncesmp]), <code>icetsm(ieltsm)</code> is the global index number of the corresponding cell (<code>icestm(ieltsm)</code> in <code></code>[1;ncel])</li>
<li><code>smacel(ieltsm,ipr)</code>: value of the injection mass rate gamma (in <img class="formulaInl" alt="$ kg \cdot m^3 \cdot s^{-1}$" src="form_544.png"/>) in the <code>ieltsm</code> cell with mass source term</li>
<li><code>itypsm(ieltsm,ivar)</code>: type of treatment for variable ivar in the <code>ieltsm</code> cell with mass source term. <code>itypsm = 0 </code>&ndash;&gt; injection of <code>ivar</code> at local value <code>itypsm = 1 </code>&ndash;&gt; injection of <code>ivar</code> at user specified value</li>
<li><code>smacel(ieltsm,ivar)</code>: specified value for variable ivar associated to the injected mass in the <code>ieltsm</code> cell with a mass source term except for <code> ivar=ipr </code></li>
</ul>
<dl class="section remark"><dt>Remarks</dt><dd><ul>
<li>if <code>itypsm(ieltsm,ivar)=0</code>, <code>smacel(ieltsm,ivar)</code> is not used</li>
<li>if <code>smacel(ieltsm,ipr)&lt;0</code>, mass is removed from the system, therefore <code>Code_Saturne</code> automatically considers <img class="formulaInl" alt="$ \varia^{in}=\varia^{(n+1)}$" src="form_545.png"/>, whatever the values of <code>itypsm</code> or <code>smacel</code> specified by the user</li>
<li>if a value <code>ivar</code> is not linked for a mass source term is imposed, no source term will be taken into account.</li>
<li>if a scalar doesn't evolve following the standard equation <img class="formulaInl" alt="$ \dfrac{\partial{(\rho \varia)}}{\partial{dt}} + \divs{(\rho \vect{u} \varia)} = ...$" src="form_546.png"/> (alternate convective field for instance), the source term set by this routine will not be correct (except in case of injection at the local value of the variable). The proper source term should be added directly in <a class="el" href="cs__user__source__terms_8f90.html#ac372efcdabb75f7ae0755c8e39034607">ustssc</a>.</li>
</ul>
</dd>
<dd>
<b> Idenfication of the cells:</b> <br />
The selection of cells where to apply the source term is based on a <a class="el" href="cs__selector__f2c_8f90.html#a38790c6fd34e3546eb4eb449224d6dcc">getcel</a> command. For more info on the syntax of the <a class="el" href="cs__selector__f2c_8f90.html#a38790c6fd34e3546eb4eb449224d6dcc">getcel</a> command, refer to the user manual or to the comments on the similar command <a class="el" href="cs__selector__f2c_8f90.html#a15b3c47b14d96445222d40944aa0d6e1">getfbr</a> in the routine <a class="el" href="cs__user__boundary__conditions_8f90.html#acecf82910f8035f38ed401e5f7dfcda0">cs_user_boundary_conditions</a>.</dd></dl>
<h1><a class="anchor" id="loc_var_ms"></a>
Local variables</h1>
<div class="fragment"><div class="line"><span class="comment">! Local variables</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">integer</span>          ieltsm</div>
<div class="line"><span class="keywordtype">integer</span>          ifac, ii</div>
<div class="line"><span class="keywordtype">integer</span>          ilelt, nlelt</div>
<div class="line"><span class="keywordtype">integer</span>          izone</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double precision</span> wind, wind2</div>
<div class="line"><span class="keywordtype">double precision</span> <a class="code" href="group__boundary__conditions.html#gacb47aea7e873638799ac53680ffe1379">dh</a>, ustar2</div>
<div class="line"><span class="keywordtype">double precision</span> xkent, xeent</div>
<div class="line"><span class="keywordtype">double precision</span> flucel</div>
<div class="line"><span class="keywordtype">double precision</span> vtot  , gamma</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: lstelt</div>
</div><!-- fragment --> <h1><a class="anchor" id="init_and_finit"></a>
Initialization and finalization</h1>
<p>The following initialization block needs to be added for the following examples: </p><div class="fragment"><div class="line"><span class="comment">! Allocate a temporary array for cells selection</span></div>
<div class="line"><span class="keyword">allocate</span>(lstelt(<a class="code" href="group__mesh.html#gab639b5ed89912ab852608e25d395a782">ncel</a>))</div>
</div><!-- fragment --><p> At the end of the subroutine, it is recommended to deallocate the work array: </p><div class="fragment"><div class="line"><span class="comment">! Deallocate the temporary array</span></div>
<div class="line"><span class="keyword">deallocate</span>(lstelt)</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">return</span></div>
<div class="line"><span class="keyword">end subroutine </span><a class="code" href="cs__user__mass__source__terms_8f90.html#ae7704de1460d2d4bcceb1886a91c3c0b">cs_user_mass_source_terms</a></div>
</div><!-- fragment --><p> In theory Fortran 95 deallocates locally-allocated arrays automatically, but deallocating arrays in a symetric manner to their alloacation is good pratice, and avoids using a different logic C and Fortran.</p>
<h1><a class="anchor" id="one_or_two"></a>
First or second call</h1>
<ul>
<li>First call: <code> iappel = 1</code>: <code>ncesmp:</code> calculation of the number of cells with mass source term</li>
<li>Second call (if <code>ncesmp&gt;0</code>): <code>iappel = 2</code>: <code>icetsm:</code> index number of cells with mass source terms</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd><ul>
<li>Do not use <code>smacel</code> in this section (it is set on the third call, <code> iappel = 3 </code>)</li>
<li>Do not use <code>icetsm</code> in this section on the first call (<code>iappel=1</code>)</li>
</ul>
</dd></dl>
<p>This section <code> (iappel = 1 or 2) </code> is only accessed at the beginning of a calculation. Should the localization of the mass source terms evolve in time, the user must identify at the beginning all cells that can potentially become a mass source term.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (iappel.eq.1.or.iappel.eq.2) <span class="keywordflow">then</span></div>
</div><!-- fragment --><h2><a class="anchor" id="example1_1"></a>
Example 1</h2>
<p>No mass source term (default)</p>
<div class="fragment"><div class="line">  ieltsm = 0</div>
</div><!-- fragment --> <h2><a class="anchor" id="example1_2"></a>
Example 2</h2>
<p>Mass source term in the cells that have boundary face of color 3 and the cells with a coordinate X between 2.5 and 5.</p>
<p>In this test in two parts, one must pay attention not to count the cells twice (a cell with a boundary face of color 3 can also have a coordinate X between 2.5 and 5). One should also pay attention that, on the first call, the array <code>icetsm</code> doesn't exist yet. It mustn't be used outside of tests (<code>iappel.eq.2</code>).</p>
<div class="fragment"><div class="line">  izone = 0</div>
<div class="line">  ieltsm = 0</div>
<div class="line"></div>
<div class="line">  <span class="comment">! Cells with coordinate X between 2.5 and 5.</span></div>
<div class="line"></div>
<div class="line">  call <a class="code" href="cs__selector__f2c_8f90.html#a38790c6fd34e3546eb4eb449224d6dcc">getcel</a>(<span class="stringliteral">&#39;X &gt; 2.5 and X &lt; 5.0&#39;</span>,nlelt,lstelt)</div>
<div class="line"></div>
<div class="line">  izone = izone + 1</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">do</span> ilelt = 1, nlelt</div>
<div class="line">    ii = lstelt(ilelt)</div>
<div class="line">    <a class="code" href="group__auxiliary.html#gaa41174423b9cab0a74f206d1b6fa4241">izctsm</a>(ii) = izone</div>
<div class="line">    ieltsm = ieltsm + 1</div>
<div class="line">    <span class="keywordflow">if</span> (iappel.eq.2) <a class="code" href="group__auxiliary.html#gabf7912f7a1d1a977430bd0e6de910c00">icetsm</a>(ieltsm) = ii</div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">! Cells with a boundary face of color 3</span></div>
<div class="line"></div>
<div class="line">  call <a class="code" href="cs__selector__f2c_8f90.html#a15b3c47b14d96445222d40944aa0d6e1">getfbr</a>(<span class="stringliteral">&#39;3&#39;</span>,nlelt,lstelt)</div>
<div class="line"></div>
<div class="line">  izone = izone + 1</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">do</span> ilelt = 1, nlelt</div>
<div class="line">    ifac = lstelt(ilelt)</div>
<div class="line">    ii   = <a class="code" href="group__mesh.html#ga0d1cf9f4d3d0b6219ac4c4bda4797470">ifabor</a>(ifac)</div>
<div class="line">    <span class="comment">! The cells that have already been counted above are not</span></div>
<div class="line">    <span class="comment">! counted again.</span></div>
<div class="line">    <span class="keywordflow">if</span> (.not.(<a class="code" href="group__mesh.html#gab3429385a23fd26b020626e430f294c6">xyzcen</a>(1,ii).lt.500.d0.and.                     &amp;</div>
<div class="line">         <a class="code" href="group__mesh.html#gab3429385a23fd26b020626e430f294c6">xyzcen</a>(1,ii).gt.250.d0)    )<span class="keywordflow">then</span></div>
<div class="line">      ieltsm = ieltsm + 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gaa41174423b9cab0a74f206d1b6fa4241">izctsm</a>(ii) = izone</div>
<div class="line">      <span class="keywordflow">if</span> (iappel.eq.2) <a class="code" href="group__auxiliary.html#gabf7912f7a1d1a977430bd0e6de910c00">icetsm</a>(ieltsm) = ii</div>
<div class="line">    <span class="keywordflow">endif</span></div>
<div class="line">  <span class="keywordflow">enddo</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="genric_sub"></a>
Generic subsection: do not modify</h2>
<ul>
<li>For <code>iappel</code> = 1: specification of <code>ncesmp</code>. This block is valid for both examples.</li>
</ul>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span> (iappel.eq.1) <span class="keywordflow">then</span></div>
<div class="line">    ncesmp = ieltsm</div>
<div class="line">  <span class="keywordflow">endif</span></div>
</div><!-- fragment --><h1><a class="anchor" id="three"></a>
Third call (for ncesmp &gt; 0)</h1>
<p><code>iappel</code> = 3: - <code>itypsm:</code> type of mass source term</p><ul>
<li><code>smacel</code> : mass source term</li>
</ul>
<dl class="section remark"><dt>Remarks</dt><dd>If <code>itypsm(ieltsm,var)</code> is set to 1, <code>smaccel(ieltsm,var)</code> must be set.</dd></dl>
<h2><a class="anchor" id="example2_1"></a>
Example 1</h2>
<p>Simulation of an inlet condition by mass source terms and printing of the total mass rate.</p>
<div class="fragment"><div class="line">  wind = 0.1d0</div>
<div class="line">  wind2 = wind**2</div>
<div class="line">  <a class="code" href="group__boundary__conditions.html#gacb47aea7e873638799ac53680ffe1379">dh</a>     = 0.5d0</div>
</div><!-- fragment --><p> Calculation of the inlet conditions for k and epsilon with standard laws in a circular pipe</p>
<div class="fragment"><div class="line">  ustar2 = 0.d0</div>
<div class="line">  xkent  = <a class="code" href="group__cstnum.html#ga7ce13e6a1bb416f0bdffcaf431135084">epzero</a></div>
<div class="line">  xeent  = <a class="code" href="group__cstnum.html#ga7ce13e6a1bb416f0bdffcaf431135084">epzero</a></div>
<div class="line"></div>
<div class="line">  call <a class="code" href="turent_8f90.html#a689f0f36b3b4c8f1a62b83b61358c5f7">keendb</a> &amp;</div>
<div class="line">  <span class="comment">!==========</span></div>
<div class="line">( wind2, <a class="code" href="group__boundary__conditions.html#gacb47aea7e873638799ac53680ffe1379">dh</a>, <a class="code" href="group__cstphy.html#gacff405ec8c1736a0ea97f7bbec06a6dd">ro0</a>, <a class="code" href="group__cstphy.html#gab7fbc85b2a13abe8a8d6a4df343995b3">viscl0</a>, <a class="code" href="group__csttur.html#ga019fba8a896d405a7cae1c2f960fd521">cmu</a>, <a class="code" href="group__csttur.html#ga0cb384d0acda415e2d329b4d807c584a">xkappa</a>,        &amp;</div>
<div class="line">  ustar2, xkent, xeent )</div>
<div class="line"></div>
<div class="line">  flucel = 0.d0</div>
<div class="line">  <span class="keywordflow">do</span> ieltsm = 1, ncesmp</div>
<div class="line">    <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#gad6a04316c3de6fdce7585d9847515b8a">ipr</a>) = 30000.d0</div>
<div class="line">    <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga92b62f3d921525535a93525229a106a2">iv</a>) = 1</div>
<div class="line">    <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga92b62f3d921525535a93525229a106a2">iv</a>) = wind</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.2) <span class="keywordflow">then</span></div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>) = xkent</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>) = xeent</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.3) <span class="keywordflow">then</span></div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga371f21c313d2820f269cc3dca293afe0">ir11</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#gafaa05f3eb9f8a6fdbf883159c8c38829">ir12</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga7041cb277fde45af4f797bb0629f045d">ir13</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#gad23a1c619be0989736f6a5ad37447790">ir22</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga02ee51e389e3eb413a72d0ad688ffb39">ir23</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#gad511370b805821b77393645adcab562a">ir33</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga371f21c313d2820f269cc3dca293afe0">ir11</a>) = 2.d0/3.d0*xkent</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#gafaa05f3eb9f8a6fdbf883159c8c38829">ir12</a>) = 0.d0</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga7041cb277fde45af4f797bb0629f045d">ir13</a>) = 0.d0</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#gad23a1c619be0989736f6a5ad37447790">ir22</a>) = 2.d0/3.d0*xkent</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga02ee51e389e3eb413a72d0ad688ffb39">ir23</a>) = 0.d0</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#gad511370b805821b77393645adcab562a">ir33</a>) = 2.d0/3.d0*xkent</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>) = xeent</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.50) <span class="keywordflow">then</span></div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>) = xkent</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>) = xeent</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga77858fb6ee8205a2416db13742d80fe4">iphi</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga77858fb6ee8205a2416db13742d80fe4">iphi</a>) = 2.d0/3.d0</div>
<div class="line">      <span class="comment">! There is no mass source term in the equation for f_bar</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.60) <span class="keywordflow">then</span></div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>) = 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>) = xkent</div>
<div class="line">      <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#gada4e3b8b2f79ca71ed8b3629e017bd53">iomg</a>)= 1</div>
<div class="line">      <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#gada4e3b8b2f79ca71ed8b3629e017bd53">iomg</a>)= xeent/<a class="code" href="group__csttur.html#ga019fba8a896d405a7cae1c2f960fd521">cmu</a>/xkent</div>
<div class="line">    <span class="keywordflow">endif</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__dimens.html#ga7eafcfac4bfc1df6ba68bd65028bca1f">nscal</a>.gt.0) <span class="keywordflow">then</span></div>
<div class="line">      <span class="keywordflow">do</span> ii = 1, <a class="code" href="group__dimens.html#ga7eafcfac4bfc1df6ba68bd65028bca1f">nscal</a></div>
<div class="line">        <a class="code" href="group__auxiliary.html#gab2d40a208a57b9db84839709dca4fd1f">itypsm</a>(ieltsm,<a class="code" href="group__main__variables.html#ga2307b4d54b829b3aeeddf6c1e4e1129f">isca</a>(ii)) = 1</div>
<div class="line">        <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#ga2307b4d54b829b3aeeddf6c1e4e1129f">isca</a>(ii)) = 1.d0</div>
<div class="line">      <span class="keywordflow">enddo</span></div>
<div class="line">    <span class="keywordflow">endif</span></div>
<div class="line">    flucel = flucel+                                            &amp;</div>
<div class="line">         <a class="code" href="group__mesh.html#ga63281eee444c94c800bc957891033901">volume</a>(<a class="code" href="group__auxiliary.html#gabf7912f7a1d1a977430bd0e6de910c00">icetsm</a>(ieltsm))*<a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#gad6a04316c3de6fdce7585d9847515b8a">ipr</a>)</div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__parall.html#ga77fe56a9acf4fc4a56b5d5ab878b7d4f">irangp</a>.ge.0) <span class="keywordflow">then</span></div>
<div class="line">    call <a class="code" href="interfaceparall_1_1parsom.html#a424406b4b54d67ae738db5ab55be7119">parsom</a>(flucel)</div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__entsor.html#ga24acc5de13a2c3d6d3d321a754820237">iwarni</a>(<a class="code" href="group__main__variables.html#gad6a04316c3de6fdce7585d9847515b8a">ipr</a>).ge.1) <span class="keywordflow">then</span></div>
<div class="line">    <span class="keyword">write</span>(<a class="code" href="group__entsor.html#ga35356a73490ee90d10e4a96684169505">nfecra</a>,1000) flucel</div>
<div class="line">  <span class="keywordflow">endif</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="example2_2"></a>
Example 2</h2>
<p>Simulation of a suction (by a pump for instance) with a total rate of <img class="formulaInl" alt="$ 80 000 \: kg \cdot s^{-1}$" src="form_547.png"/>. The suction rate is supposed to be uniformly distributed on all the cells selected above.</p>
<p>Calculation of the total volume of the area where the mass source term is imposed (the case of parallel computing is taken into account with the call to <code>parsom</code>).</p>
<div class="fragment"><div class="line">  vtot = 0.d0</div>
<div class="line">  <span class="keywordflow">do</span> ieltsm = 1, ncesmp</div>
<div class="line">    vtot = vtot + <a class="code" href="group__mesh.html#ga63281eee444c94c800bc957891033901">volume</a>(<a class="code" href="group__auxiliary.html#gabf7912f7a1d1a977430bd0e6de910c00">icetsm</a>(ieltsm))</div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__parall.html#ga77fe56a9acf4fc4a56b5d5ab878b7d4f">irangp</a>.ge.0) <span class="keywordflow">then</span></div>
<div class="line">    call <a class="code" href="interfaceparall_1_1parsom.html#a424406b4b54d67ae738db5ab55be7119">parsom</a>(vtot)</div>
<div class="line">  <span class="keywordflow">endif</span></div>
</div><!-- fragment --><p> The mass suction rate is <img class="formulaInl" alt="$ \Gamma = - \dfrac{80000}{v_{tot}} $" src="form_548.png"/> (in <img class="formulaInl" alt="$ kg \cdot m^{-3} \cdot s^{-1}$" src="form_549.png"/>). It is set below, with a test for cases where <img class="formulaInl" alt="$ v_{tot} = 0 $" src="form_550.png"/>. The total mass rate is calculated for verification.</p>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span> (vtot.gt.0.d0) <span class="keywordflow">then</span></div>
<div class="line">    gamma = -80000.d0/vtot</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">    <span class="keyword">write</span>(<a class="code" href="group__entsor.html#ga35356a73490ee90d10e4a96684169505">nfecra</a>,9000) vtot</div>
<div class="line">    call <a class="code" href="cs__base__fortran_8c.html#ad2ce20d28f7075c1ed29cb67a990c7a6">csexit</a>(1)</div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  flucel = 0.d0</div>
<div class="line">  <span class="keywordflow">do</span> ieltsm = 1, ncesmp</div>
<div class="line">    <a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#gad6a04316c3de6fdce7585d9847515b8a">ipr</a>) = gamma</div>
<div class="line">    flucel = flucel+                                          &amp;</div>
<div class="line">         <a class="code" href="group__mesh.html#ga63281eee444c94c800bc957891033901">volume</a>(<a class="code" href="group__auxiliary.html#gabf7912f7a1d1a977430bd0e6de910c00">icetsm</a>(ieltsm))*<a class="code" href="group__auxiliary.html#ga44665e060ed56962486419027016c32e">smacel</a>(ieltsm,<a class="code" href="group__main__variables.html#gad6a04316c3de6fdce7585d9847515b8a">ipr</a>)</div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__parall.html#ga77fe56a9acf4fc4a56b5d5ab878b7d4f">irangp</a>.ge.0) <span class="keywordflow">then</span></div>
<div class="line">    call <a class="code" href="interfaceparall_1_1parsom.html#a424406b4b54d67ae738db5ab55be7119">parsom</a>(flucel)</div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__entsor.html#ga24acc5de13a2c3d6d3d321a754820237">iwarni</a>(<a class="code" href="group__main__variables.html#gad6a04316c3de6fdce7585d9847515b8a">ipr</a>).ge.1) <span class="keywordflow">then</span></div>
<div class="line">    <span class="keyword">write</span>(<a class="code" href="group__entsor.html#ga35356a73490ee90d10e4a96684169505">nfecra</a>,2000) flucel, vtot</div>
<div class="line">  <span class="keywordflow">endif</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="end3"></a>
End third call</h2>
<div class="fragment"><div class="line"><span class="keywordflow">endif</span></div>
</div><!-- fragment --> <h2><a class="anchor" id="format"></a>
Formats</h2>
<div class="fragment"><div class="line"> 1000 <span class="keyword">format</span>(/,<span class="stringliteral">&#39;Mass rate generated in the domain: &#39;</span>,e14.5,/)</div>
<div class="line"></div>
<div class="line"> 2000 <span class="keyword">format</span>(/,<span class="stringliteral">&#39;Mass flux rate generated in the domain: &#39;</span>,e14.5,/,         &amp;</div>
<div class="line">               <span class="stringliteral">&#39;                         distributed on the volume: &#39;</span>,e14.5)</div>
<div class="line"></div>
<div class="line"> 9000 <span class="keyword">format</span>(/,<span class="stringliteral">&#39;Error in cs_user_mass_source_terms&#39;</span>,/,                     &amp;</div>
<div class="line">               <span class="stringliteral">&#39;   the volume of the mass suction area is = &#39;</span>,e14.5,/)</div>
</div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 6 2016 17:20:36 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
