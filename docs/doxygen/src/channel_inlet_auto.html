<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Infinite channel inlet with near-inlet feedback</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">programmer&#39;s documentation</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="cs_user_examples.html"><span>User&#160;examples</span></a></li>
      <li><a href="cs_var_dico.html"><span>Fortran-C&#160;naming&#160;reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="cs_user_examples.html">User examples</a></li><li class="navelem"><a class="el" href="cs_user_boundary_conditions_examples.html">cs_user_boundary_conditions.f90</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Infinite channel inlet with near-inlet feedback </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A second method of defining an inlet condition which converges towards an infinite channel profile is based simply on feedback from values computed at inlet cell centers (combining the inlet boundary conditions and the effect of wall friction on the inlet walls). It assumes the mesh is very regular and orthogonal, at least on the first two inlet cell layers (using a gradient correction in the case of a less regular mesh might work, but has never been tested.</p>
<h1><a class="anchor" id="channel_inlet_auto_loc_var_bc"></a>
Local variables to be added</h1>
<p>The following local variables need to be defined for the examples in this section:</p>
<div class="fragment"><div class="line"><span class="keywordtype">integer</span>          ifac, iel, ii, ivar, irangv, iun, ilelt, nlelt</div>
<div class="line"><span class="keywordtype">double precision</span> xkent, xeent, xphi, xfb</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">integer</span>          ibc, ix, ny, ios</div>
<div class="line"><span class="keywordtype">double precision</span> uent, vent, went, xustar2, xdh, d2s3, rhomoy</div>
<div class="line"><span class="keywordtype">double precision</span> acc(2), fmprsc, fmul, uref2, vnrm</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>, <span class="keywordtype">dimension(:)</span> :: lstelt, mrkcel</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: bfpro_rom</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cvar_r11, cvar_r22, cvar_r33</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cvar_r12, cvar_r23, cvar_r13</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cvar_k, cvar_ep, cvar_phi</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cvar_omg</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cvar_al, cvar_fb</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cvar_nusa</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cvar_scal</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">pointer</span> :: cvar_vel</div>
</div><!-- fragment --> <h1><a class="anchor" id="channel_inlet_auto_init_bc"></a>
Initialization and finalization</h1>
<p>Initialization and finalization is similar to that of the base examples</p>
<h1><a class="anchor" id="channel_inlet_auto_example_1_bc"></a>
Body</h1>
<p>Here, we define an inlet boundary condition for a very long channel or duct with a section matching the boundary faces of group 'INLET'.</p>
<p>We fix a mean inlet velocity, and use a feedback loop assuming a fixed-point type behavior will allow us to reach a state matching that of a very long inlet channel.</p>
<dl class="section warning"><dt>Warning</dt><dd>We assume other boundary conditions are defined before this one (ideally, using the GUI).</dd>
<dd>
We also assume that the mesh is orthogonal at the inlet, and we are using a RANS (not LES) computation. to the current inlet.</dd></dl>
<p>For EBRSM of V2f models, to avoid laminarization at the inlet, the initial velocity (at the first time step) is divided by 10 on inlet faces adjacent to the boundary, so as to ensure a velocity gradient and turbulent production. Otherwise, the initialization may fail.</p>
<div class="fragment"><div class="line"><span class="comment">call getfbr(&#39;INLET&#39;, nlelt, lstelt)</span></div>
<div class="line"><span class="comment">!==========</span></div>
<div class="line"></div>
<div class="line">fmprsc = 1.d0 <span class="comment">! mean prescribed velocity</span></div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__time__step__options.html#ga8893d91edb2d95d49bfeadfe9a3b12db">ntcabs</a>.eq.1) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">! For the Rij-EBRSM model (and possibly V2f), we need a non-flat profile,</span></div>
<div class="line">  <span class="comment">! so as to ensure turbulent production, and avoid laminarization;</span></div>
<div class="line">  <span class="comment">! here, we simply divide the initial velocity by 10 for inlet</span></div>
<div class="line">  <span class="comment">! faces adjacent to the wall.</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">! The loop below assumes wall conditions have been defined first</span></div>
<div class="line">  <span class="comment">! (in the GUI, or in this file, before the current test).</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.32 .or. <a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.5) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">    <span class="keyword">allocate</span>(mrkcel(<a class="code" href="group__mesh.html#ga639172a5bdf2c9669ddeab06a362b992">ncelet</a>))</div>
<div class="line">    <span class="keywordflow">do</span> iel = 1, <a class="code" href="group__mesh.html#ga639172a5bdf2c9669ddeab06a362b992">ncelet</a></div>
<div class="line">      mrkcel(iel) = 0</div>
<div class="line">    <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">do</span> ifac = 1, <a class="code" href="group__mesh.html#gafd405a008e10defbfe94d267457278c5">nfabor</a></div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__coupled__case.html#ga60f3df1381261b9527adb47ac21aa62d">itypfb</a>(ifac) .eq. <a class="code" href="group__paramx.html#ga6431a0e8fa2d4488763b8d07d1b0bc95">iparoi</a>) <span class="keywordflow">then</span></div>
<div class="line">        iel = <a class="code" href="group__mesh.html#ga0d1cf9f4d3d0b6219ac4c4bda4797470">ifabor</a>(ifac)</div>
<div class="line">        mrkcel(iel) = 1</div>
<div class="line">      <span class="keywordflow">endif</span></div>
<div class="line">    <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">do</span> ilelt = 1, nlelt</div>
<div class="line"></div>
<div class="line">    ifac = lstelt(ilelt)</div>
<div class="line">    iel = <a class="code" href="group__mesh.html#ga0d1cf9f4d3d0b6219ac4c4bda4797470">ifabor</a>(ifac)</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__coupled__case.html#ga60f3df1381261b9527adb47ac21aa62d">itypfb</a>(ifac) = <a class="code" href="group__paramx.html#gacd9bb8a485ad1e678b9a9a42ed812d22">ientre</a></div>
<div class="line"></div>
<div class="line">    rcodcl(ifac,<a class="code" href="group__main__variables.html#gab6cfa74e47a0d12d050a2754262a4b95">iu</a>,1) = - fmprsc * <a class="code" href="group__mesh.html#gab92a04b00566bd35a2817f05ceeab026">surfbo</a>(1,ifac) / <a class="code" href="group__mesh.html#ga8c334f6ec151c5c1545282a6726d335e">surfbn</a>(ifac)</div>
<div class="line">    rcodcl(ifac,<a class="code" href="group__main__variables.html#ga92b62f3d921525535a93525229a106a2">iv</a>,1) = - fmprsc * <a class="code" href="group__mesh.html#gab92a04b00566bd35a2817f05ceeab026">surfbo</a>(2,ifac) / <a class="code" href="group__mesh.html#ga8c334f6ec151c5c1545282a6726d335e">surfbn</a>(ifac)</div>
<div class="line">    rcodcl(ifac,<a class="code" href="group__main__variables.html#gafe8e8df233ec94d884116c7d0aa29ef2">iw</a>,1) = - fmprsc * <a class="code" href="group__mesh.html#gab92a04b00566bd35a2817f05ceeab026">surfbo</a>(3,ifac) / <a class="code" href="group__mesh.html#ga8c334f6ec151c5c1545282a6726d335e">surfbn</a>(ifac)</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.32 .or. <a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.5) <span class="keywordflow">then</span></div>
<div class="line">      <span class="keywordflow">if</span> (mrkcel(iel) .eq. 1) <span class="keywordflow">then</span></div>
<div class="line">        rcodcl(ifac,<a class="code" href="group__main__variables.html#gab6cfa74e47a0d12d050a2754262a4b95">iu</a>,1) = fmprsc/10.d0</div>
<div class="line">      <span class="keywordflow">endif</span></div>
<div class="line">    <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">    uref2 = rcodcl(ifac,<a class="code" href="group__main__variables.html#gab6cfa74e47a0d12d050a2754262a4b95">iu</a>,1)**2  &amp;</div>
<div class="line">          + rcodcl(ifac,<a class="code" href="group__main__variables.html#ga92b62f3d921525535a93525229a106a2">iv</a>,1)**2  &amp;</div>
<div class="line">          + rcodcl(ifac,<a class="code" href="group__main__variables.html#gafe8e8df233ec94d884116c7d0aa29ef2">iw</a>,1)**2</div>
<div class="line">    uref2 = max(uref2,1.d-12)</div>
<div class="line"></div>
<div class="line">    <span class="comment">!   Turbulence example computed using equations valid for a pipe.</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">!   We will be careful to specify a hydraulic diameter adapted</span></div>
<div class="line">    <span class="comment">!     to the current inlet.</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">!   We will also be careful if necessary to use a more precise</span></div>
<div class="line">    <span class="comment">!     formula for the dynamic viscosity use in the calculation of</span></div>
<div class="line">    <span class="comment">!     the Reynolds number (especially if it is variable, it may be</span></div>
<div class="line">    <span class="comment">!     useful to take the law from &#39;usphyv&#39;. Here, we use by default</span></div>
<div class="line">    <span class="comment">!     the &#39;viscl0&quot; value.</span></div>
<div class="line">    <span class="comment">!   Regarding the density, we have access to its value at boundary</span></div>
<div class="line">    <span class="comment">!     faces (romb) so this value is the one used here (specifically,</span></div>
<div class="line">    <span class="comment">!     it is consistent with the processing in &#39;usphyv&#39;, in case of</span></div>
<div class="line">    <span class="comment">!     variable density)</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">!     Hydraulic diameter</span></div>
<div class="line">    xdh     = 1.d0</div>
<div class="line"></div>
<div class="line">    <span class="comment">!   Calculation of friction velocity squared (ustar2)</span></div>
<div class="line">    <span class="comment">!     and of k and epsilon at the inlet (xkent and xeent) using</span></div>
<div class="line">    <span class="comment">!     standard laws for a circular pipe</span></div>
<div class="line">    <span class="comment">!     (their initialization is not needed here but is good practice).</span></div>
<div class="line">    rhomoy  = bfpro_rom(ifac)</div>
<div class="line">    xustar2 = 0.d0</div>
<div class="line">    xkent   = <a class="code" href="group__cstnum.html#ga7ce13e6a1bb416f0bdffcaf431135084">epzero</a></div>
<div class="line">    xeent   = <a class="code" href="group__cstnum.html#ga7ce13e6a1bb416f0bdffcaf431135084">epzero</a></div>
<div class="line"></div>
<div class="line">    call <a class="code" href="turent_8f90.html#a689f0f36b3b4c8f1a62b83b61358c5f7">keendb</a> &amp;</div>
<div class="line">    <span class="comment">!==========</span></div>
<div class="line">  ( uref2, xdh, rhomoy, <a class="code" href="group__cstphy.html#gab7fbc85b2a13abe8a8d6a4df343995b3">viscl0</a>, <a class="code" href="group__csttur.html#ga019fba8a896d405a7cae1c2f960fd521">cmu</a>, <a class="code" href="group__csttur.html#ga0cb384d0acda415e2d329b4d807c584a">xkappa</a>,   &amp;</div>
<div class="line">    xustar2, xkent, xeent )</div>
<div class="line"></div>
<div class="line">    <span class="comment">! itytur is a flag equal to iturb/10</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.2) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>,1)  = xkent</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>,1) = xeent</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.3) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga371f21c313d2820f269cc3dca293afe0">ir11</a>,1) = d2s3*xkent</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gad23a1c619be0989736f6a5ad37447790">ir22</a>,1) = d2s3*xkent</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gad511370b805821b77393645adcab562a">ir33</a>,1) = d2s3*xkent</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gafaa05f3eb9f8a6fdbf883159c8c38829">ir12</a>,1) = 0.d0</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga7041cb277fde45af4f797bb0629f045d">ir13</a>,1) = 0.d0</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga02ee51e389e3eb413a72d0ad688ffb39">ir23</a>,1) = 0.d0</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>,1)  = xeent</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.32) <span class="keywordflow">then</span></div>
<div class="line">        rcodcl(ifac,<a class="code" href="group__main__variables.html#ga1dad58acc909ba7f14298ada73fa1f72">ial</a>,1)  = 1.d0</div>
<div class="line">      <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.5) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>,1)   = xkent</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>,1)  = xeent</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga77858fb6ee8205a2416db13742d80fe4">iphi</a>,1) = d2s3</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.50) <span class="keywordflow">then</span></div>
<div class="line">        rcodcl(ifac,<a class="code" href="group__main__variables.html#gaa1cc52ea19b5d872238313ce1460e84a">ifb</a>,1)  = 0.d0</div>
<div class="line">      <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.51) <span class="keywordflow">then</span></div>
<div class="line">        rcodcl(ifac,<a class="code" href="group__main__variables.html#ga1dad58acc909ba7f14298ada73fa1f72">ial</a>,1)  = 0.d0</div>
<div class="line">      <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.60) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>,1)   = xkent</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gada4e3b8b2f79ca71ed8b3629e017bd53">iomg</a>,1) = xeent/<a class="code" href="group__csttur.html#ga019fba8a896d405a7cae1c2f960fd521">cmu</a>/xkent</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.70) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gaa587bbda46fe2153de41858cecbd7902">inusa</a>,1) = <a class="code" href="group__csttur.html#ga019fba8a896d405a7cae1c2f960fd521">cmu</a>*xkent**2/xeent</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">! Handle scalars</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__dimens.html#ga7eafcfac4bfc1df6ba68bd65028bca1f">nscal</a>.gt.0) <span class="keywordflow">then</span></div>
<div class="line">      <span class="keywordflow">do</span> ii = 1, <a class="code" href="group__dimens.html#ga7eafcfac4bfc1df6ba68bd65028bca1f">nscal</a></div>
<div class="line">        rcodcl(ifac,<a class="code" href="group__main__variables.html#ga2307b4d54b829b3aeeddf6c1e4e1129f">isca</a>(ii),1) = 1.d0</div>
<div class="line">      <span class="keywordflow">enddo</span></div>
<div class="line">    <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.32 .or. <a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.5) <span class="keywordflow">then</span></div>
<div class="line">    <span class="keyword">deallocate</span>(mrkcel)</div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line"></div>
<div class="line"><span class="comment">! Subsequent time steps</span></div>
<div class="line"><span class="comment">!----------------------</span></div>
<div class="line"></div>
<div class="line">  acc(1) = 0.d0</div>
<div class="line">  acc(2) = 0.d0</div>
<div class="line"></div>
<div class="line">  <span class="comment">! Estimate multiplier</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">do</span> ilelt = 1, nlelt</div>
<div class="line"></div>
<div class="line">    ifac = lstelt(ilelt)</div>
<div class="line">    iel = <a class="code" href="group__mesh.html#ga0d1cf9f4d3d0b6219ac4c4bda4797470">ifabor</a>(ifac)</div>
<div class="line"></div>
<div class="line">    vnrm = sqrt(cvar_vel(1,iel)**2 + cvar_vel(2,iel)**2 + cvar_vel(3,iel)**2)</div>
<div class="line">    acc(1) = acc(1) + vnrm*<a class="code" href="group__mesh.html#ga8c334f6ec151c5c1545282a6726d335e">surfbn</a>(ifac)</div>
<div class="line">    acc(2) = acc(2) + <a class="code" href="group__mesh.html#ga8c334f6ec151c5c1545282a6726d335e">surfbn</a>(ifac)</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__parall.html#ga77fe56a9acf4fc4a56b5d5ab878b7d4f">irangp</a>.ge.0) <span class="keywordflow">then</span></div>
<div class="line">    call <a class="code" href="interfaceparall_1_1parrsm.html#a57f71e27cc5f6bfec636e53dba621ca4">parrsm</a>(2, acc)</div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  fmul = fmprsc/(acc(1)/acc(2)) <span class="comment">! 1 / estimate flow multiplier</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">! Apply BC</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">do</span> ilelt = 1, nlelt</div>
<div class="line"></div>
<div class="line">    ifac = lstelt(ilelt)</div>
<div class="line">    iel = <a class="code" href="group__mesh.html#ga0d1cf9f4d3d0b6219ac4c4bda4797470">ifabor</a>(ifac)</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group__coupled__case.html#ga60f3df1381261b9527adb47ac21aa62d">itypfb</a>(ifac) = <a class="code" href="group__paramx.html#gacd9bb8a485ad1e678b9a9a42ed812d22">ientre</a></div>
<div class="line"></div>
<div class="line">    vnrm = sqrt(cvar_vel(1,iel)**2 + cvar_vel(2,iel)**2 + cvar_vel(3,iel)**2)</div>
<div class="line"></div>
<div class="line">    rcodcl(ifac,<a class="code" href="group__main__variables.html#gab6cfa74e47a0d12d050a2754262a4b95">iu</a>,1) = - fmul * vnrm * <a class="code" href="group__mesh.html#gab92a04b00566bd35a2817f05ceeab026">surfbo</a>(1,ifac) / <a class="code" href="group__mesh.html#ga8c334f6ec151c5c1545282a6726d335e">surfbn</a>(ifac)</div>
<div class="line">    rcodcl(ifac,<a class="code" href="group__main__variables.html#ga92b62f3d921525535a93525229a106a2">iv</a>,1) = - fmul * vnrm * <a class="code" href="group__mesh.html#gab92a04b00566bd35a2817f05ceeab026">surfbo</a>(2,ifac) / <a class="code" href="group__mesh.html#ga8c334f6ec151c5c1545282a6726d335e">surfbn</a>(ifac)</div>
<div class="line">    rcodcl(ifac,<a class="code" href="group__main__variables.html#gafe8e8df233ec94d884116c7d0aa29ef2">iw</a>,1) = - fmul * vnrm * <a class="code" href="group__mesh.html#gab92a04b00566bd35a2817f05ceeab026">surfbo</a>(3,ifac) / <a class="code" href="group__mesh.html#ga8c334f6ec151c5c1545282a6726d335e">surfbn</a>(ifac)</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.2) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>,1)  = cvar_k(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>,1) = cvar_ep(iel)</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.3) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga371f21c313d2820f269cc3dca293afe0">ir11</a>,1) = cvar_r11(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gad23a1c619be0989736f6a5ad37447790">ir22</a>,1) = cvar_r22(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gad511370b805821b77393645adcab562a">ir33</a>,1) = cvar_r33(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gafaa05f3eb9f8a6fdbf883159c8c38829">ir12</a>,1) = cvar_r12(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga7041cb277fde45af4f797bb0629f045d">ir13</a>,1) = cvar_r13(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga02ee51e389e3eb413a72d0ad688ffb39">ir23</a>,1) = cvar_r23(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>,1)  = cvar_ep(iel)</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.32) <span class="keywordflow">then</span></div>
<div class="line">        rcodcl(ifac,<a class="code" href="group__main__variables.html#ga1dad58acc909ba7f14298ada73fa1f72">ial</a>,1)  = cvar_al(iel)</div>
<div class="line">      <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.5) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>,1)  = cvar_k(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>,1) = cvar_ep(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga77858fb6ee8205a2416db13742d80fe4">iphi</a>,1) = cvar_phi(iel)</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.50) <span class="keywordflow">then</span></div>
<div class="line">        rcodcl(ifac,<a class="code" href="group__main__variables.html#gaa1cc52ea19b5d872238313ce1460e84a">ifb</a>,1)  = cvar_fb(iel)</div>
<div class="line">      <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.51) <span class="keywordflow">then</span></div>
<div class="line">        rcodcl(ifac,<a class="code" href="group__main__variables.html#ga1dad58acc909ba7f14298ada73fa1f72">ial</a>,1)  = cvar_al(iel)</div>
<div class="line">      <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.60) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>,1)  = cvar_k(iel)</div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gada4e3b8b2f79ca71ed8b3629e017bd53">iomg</a>,1) = cvar_omg(iel)</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.70) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">      rcodcl(ifac,<a class="code" href="group__main__variables.html#gaa587bbda46fe2153de41858cecbd7902">inusa</a>,1) = cvar_nusa(iel)</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">! Handle scalars (a correction similar to that of velocity is suggested</span></div>
<div class="line">    <span class="comment">!                 rather than the simpler code below)</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__dimens.html#ga7eafcfac4bfc1df6ba68bd65028bca1f">nscal</a>.gt.0) <span class="keywordflow">then</span></div>
<div class="line">      <span class="keywordflow">do</span> ii = 1, <a class="code" href="group__dimens.html#ga7eafcfac4bfc1df6ba68bd65028bca1f">nscal</a></div>
<div class="line">        call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#ga57aa6fc90649d0b34039aa88d2fec6f4">ivarfl</a>(<a class="code" href="group__main__variables.html#ga2307b4d54b829b3aeeddf6c1e4e1129f">isca</a>(ii)), cvar_scal)</div>
<div class="line">        rcodcl(ifac,<a class="code" href="group__main__variables.html#ga2307b4d54b829b3aeeddf6c1e4e1129f">isca</a>(ii),1) = cvar_scal(ii)</div>
<div class="line">      <span class="keywordflow">enddo</span></div>
<div class="line">    <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line"><span class="keywordflow">endif</span></div>
</div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 6 2016 17:20:36 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
