<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Extract a 1D profile</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">programmer&#39;s documentation</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="cs_user_examples.html"><span>User&#160;examples</span></a></li>
      <li><a href="cs_var_dico.html"><span>Fortran-C&#160;naming&#160;reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="cs_user_examples.html">User examples</a></li><li class="navelem"><a class="el" href="cs_user_extra_operations_examples.html">cs_user_extra_operations.f90</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Extract a 1D profile </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="cs_user_extra_operations_examples_oned_profile"></a>
Extract a 1D profile</h1>
<p>This is an example of <a class="el" href="cs__user__extra__operations_8c.html#ab24cad8754d52099d4c8d540c8a4f646">cs_user_extra_operations</a> which performs 1D profile.</p>
<h2><a class="anchor" id="cs_user_extra_operations_examples_loc_var_1dp"></a>
Local variables to be added</h2>
<div class="fragment"><div class="line"><span class="keywordtype">integer</span>          iel</div>
<div class="line"><span class="keywordtype">integer</span>          iel1</div>
<div class="line"><span class="keywordtype">integer</span>          impout</div>
<div class="line"><span class="keywordtype">integer</span>          ii     , irangv , irang1 , npoint</div>
<div class="line"><span class="keywordtype">integer</span>          iun</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double precision</span> xyz(3), xabs, xu, xv, xw, xk, xeps</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:,:)</span>, <span class="keywordtype">pointer</span> :: cvar_vel</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cvar_k, cvar_ep, cvar_omg</div>
<div class="line"><span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">pointer</span> :: cvar_r11, cvar_r22, cvar_r33</div>
<div class="line"></div>
</div><!-- fragment --> <h2><a class="anchor" id="cs_user_extra_operations_examples_1dp_body"></a>
Body</h2>
<p>We seek here to extract the profile of U, V, W, k and epsilon on an arbitrary 1D curve based on a curvilear abscissa. The profile is described in the 'profile.dat' file (do not forget to define it as user data in the run script).</p>
<ul>
<li>the curve used here is the segment: [(0;0;0),(0;0.1;0)], but the generalization to an arbitrary curve is simple.</li>
<li>the routine handles parallelism an periodicity, as well as the different turbulence models.</li>
<li>the 1D curve is discretized into 'npoint' points. For each of these points, we search for the closest cell center and we output the variable values at this cell center. For better consistency, the coordinate which is output is that of the cell center (instead of the initial point).</li>
<li>we avoid using the same cell multiple times (in case several points an the curve are associated with the same cell).</li>
</ul>
<p>Here is the corresponding code:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (<a class="code" href="group__time__step__options.html#ga8893d91edb2d95d49bfeadfe9a3b12db">ntcabs</a>.eq.<a class="code" href="group__time__step__options.html#ga6004960e06cb99c7b484d3be1f156d87">ntmabs</a>) <span class="keywordflow">then</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">! Map field arrays</span></div>
<div class="line">  call <a class="code" href="classfield.html#aea9829c213afac2a2c7ad39bfb85d191">field_get_val_v</a>(<a class="code" href="group__field__map.html#ga57aa6fc90649d0b34039aa88d2fec6f4">ivarfl</a>(<a class="code" href="group__main__variables.html#gab6cfa74e47a0d12d050a2754262a4b95">iu</a>), cvar_vel)</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.2 .or. <a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.50    &amp;</div>
<div class="line">       .or. <a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.60) <span class="keywordflow">then</span></div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#ga57aa6fc90649d0b34039aa88d2fec6f4">ivarfl</a>(<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>), cvar_k)</div>
<div class="line">  <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.3) <span class="keywordflow">then</span></div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#ga57aa6fc90649d0b34039aa88d2fec6f4">ivarfl</a>(<a class="code" href="group__main__variables.html#ga371f21c313d2820f269cc3dca293afe0">ir11</a>), cvar_r11)</div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#ga57aa6fc90649d0b34039aa88d2fec6f4">ivarfl</a>(<a class="code" href="group__main__variables.html#gad23a1c619be0989736f6a5ad37447790">ir22</a>), cvar_r22)</div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#ga57aa6fc90649d0b34039aa88d2fec6f4">ivarfl</a>(<a class="code" href="group__main__variables.html#gad511370b805821b77393645adcab562a">ir33</a>), cvar_r33)</div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line">  <span class="keywordflow">if</span> (     <a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.2 .or. <a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.3    &amp;</div>
<div class="line">       .or. <a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.50) <span class="keywordflow">then</span></div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#ga57aa6fc90649d0b34039aa88d2fec6f4">ivarfl</a>(<a class="code" href="group__main__variables.html#ga52f2cbc26bf83508a779335c668f2895">iep</a>), cvar_ep)</div>
<div class="line">  <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.60) <span class="keywordflow">then</span></div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#ga57aa6fc90649d0b34039aa88d2fec6f4">ivarfl</a>(<a class="code" href="group__main__variables.html#ga0da9329edbed84e564928b950e9d9570">ik</a>), cvar_k)</div>
<div class="line">    call <a class="code" href="classfield.html#a561d2e83a4150a004bb7798ade2cc000">field_get_val_s</a>(<a class="code" href="group__field__map.html#ga57aa6fc90649d0b34039aa88d2fec6f4">ivarfl</a>(<a class="code" href="group__main__variables.html#gada4e3b8b2f79ca71ed8b3629e017bd53">iomg</a>), cvar_omg)</div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">! Only process of rank 0 (parallel) or -1 (scalar) writes to this file.</span></div>
<div class="line">  <span class="comment">! We use &#39;user&#39; Fortran units.</span></div>
<div class="line">  impout = <a class="code" href="group__userfile.html#ga7873409e248968863e27022f8aa7462b">impusr</a>(1)</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__parall.html#ga77fe56a9acf4fc4a56b5d5ab878b7d4f">irangp</a>.le.0) <span class="keywordflow">then</span></div>
<div class="line">    <span class="keyword">open</span>(impout,file=<span class="stringliteral">&#39;profile.dat&#39;</span>)</div>
<div class="line">    <span class="keyword">write</span>(impout,*)  &amp;</div>
<div class="line">         <span class="stringliteral">&#39;# z(m) U(m/s) V(m/s) W(m/s) k(m2/s2) eps(m2/s3)&#39;</span></div>
<div class="line">  <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  npoint = 200</div>
<div class="line">  iel1   = -999</div>
<div class="line">  irang1 = -999</div>
<div class="line">  <span class="keywordflow">do</span> ii = 1, npoint</div>
<div class="line"></div>
<div class="line">    xyz(1) = 0.d0</div>
<div class="line">    xyz(2) = float(ii-1)/float(npoint-1)*0.1d0</div>
<div class="line">    xyz(3) = 0.d0</div>
<div class="line"></div>
<div class="line">    call <a class="code" href="cs__prototypes_8h.html#a21439fe44f37c72f6523ddd4edebacae">findpt</a>(<a class="code" href="group__mesh.html#ga639172a5bdf2c9669ddeab06a362b992">ncelet</a>, <a class="code" href="group__mesh.html#gab639b5ed89912ab852608e25d395a782">ncel</a>, <a class="code" href="group__mesh.html#gab3429385a23fd26b020626e430f294c6">xyzcen</a>, xyz(1), xyz(2), xyz(3), iel, irangv)</div>
<div class="line">    <span class="comment">!==========</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((iel.ne.iel1).or.(irangv.ne.irang1)) <span class="keywordflow">then</span></div>
<div class="line">      iel1   = iel</div>
<div class="line">      irang1 = irangv</div>
<div class="line"></div>
<div class="line">      <span class="comment">! Set temporary variables xu, xv, ... for the process containing</span></div>
<div class="line">      <span class="comment">! the point and then send it to other processes.</span></div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__parall.html#ga77fe56a9acf4fc4a56b5d5ab878b7d4f">irangp</a>.eq.irangv) <span class="keywordflow">then</span></div>
<div class="line">        xabs = <a class="code" href="group__mesh.html#gab3429385a23fd26b020626e430f294c6">xyzcen</a>(2,iel)</div>
<div class="line">        xu   = cvar_vel(1,iel)</div>
<div class="line">        xv   = cvar_vel(2,iel)</div>
<div class="line">        xw   = cvar_vel(3,iel)</div>
<div class="line">        xk   = 0.d0</div>
<div class="line">        xeps = 0.d0</div>
<div class="line">        <span class="keywordflow">if</span> (     <a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.2 .or. <a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.50    &amp;</div>
<div class="line">            .or. <a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.60) <span class="keywordflow">then</span></div>
<div class="line">          xk = cvar_k(iel)</div>
<div class="line">        <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.3) <span class="keywordflow">then</span></div>
<div class="line">          xk = (  cvar_r11(iel) + cvar_r22(iel)          &amp;</div>
<div class="line">                + cvar_r33(iel)) / 2.d0</div>
<div class="line">        <span class="keywordflow">endif</span></div>
<div class="line">        <span class="keywordflow">if</span> (     <a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.2 .or. <a class="code" href="group__turbulence.html#ga65b4137820e92089e0ae2eae651509e4">itytur</a>.eq.3    &amp;</div>
<div class="line">            .or. <a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.50) <span class="keywordflow">then</span></div>
<div class="line">          xeps = cvar_ep(iel)</div>
<div class="line">        <span class="keywordflow">elseif</span> (<a class="code" href="group__turbulence.html#ga422877d65f809f5110d083afaad92854">iturb</a>.eq.60) <span class="keywordflow">then</span></div>
<div class="line">          xeps = <a class="code" href="group__csttur.html#ga019fba8a896d405a7cae1c2f960fd521">cmu</a>*cvar_k(iel)*cvar_omg(iel)</div>
<div class="line">        <span class="keywordflow">endif</span></div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        xabs = 0.d0</div>
<div class="line">        xu   = 0.d0</div>
<div class="line">        xv   = 0.d0</div>
<div class="line">        xw   = 0.d0</div>
<div class="line">        xk   = 0.d0</div>
<div class="line">        xeps = 0.d0</div>
<div class="line">      <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">      <span class="comment">! Broadcast to other ranks in parallel</span></div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__parall.html#ga77fe56a9acf4fc4a56b5d5ab878b7d4f">irangp</a>.ge.0) <span class="keywordflow">then</span></div>
<div class="line">        call <a class="code" href="interfaceparall_1_1parall__bcast__r.html#a2ffd10a922d5652f9e3fb815c226873d">parall_bcast_r</a>(irangv, xabs)</div>
<div class="line">        call <a class="code" href="interfaceparall_1_1parall__bcast__r.html#a2ffd10a922d5652f9e3fb815c226873d">parall_bcast_r</a>(irangv, xu)</div>
<div class="line">        call <a class="code" href="interfaceparall_1_1parall__bcast__r.html#a2ffd10a922d5652f9e3fb815c226873d">parall_bcast_r</a>(irangv, xv)</div>
<div class="line">        call <a class="code" href="interfaceparall_1_1parall__bcast__r.html#a2ffd10a922d5652f9e3fb815c226873d">parall_bcast_r</a>(irangv, xw)</div>
<div class="line">        call <a class="code" href="interfaceparall_1_1parall__bcast__r.html#a2ffd10a922d5652f9e3fb815c226873d">parall_bcast_r</a>(irangv, xk)</div>
<div class="line">        call <a class="code" href="interfaceparall_1_1parall__bcast__r.html#a2ffd10a922d5652f9e3fb815c226873d">parall_bcast_r</a>(irangv, xeps)</div>
<div class="line">      <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code" href="group__parall.html#ga77fe56a9acf4fc4a56b5d5ab878b7d4f">irangp</a>.le.0) <span class="keyword">write</span>(impout,99) xabs, xu, xv, xw, xk, xeps</div>
<div class="line"></div>
<div class="line">99    <span class="keyword">format</span>(6g17.9)</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">endif</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">enddo</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__parall.html#ga77fe56a9acf4fc4a56b5d5ab878b7d4f">irangp</a>.le.0) <span class="keyword">close</span>(impout)</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">endif</span></div>
</div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 6 2016 17:20:36 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
